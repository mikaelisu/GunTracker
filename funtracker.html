<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArmorLog | Inventory & Maintenance</title>
    <style>
        :root { --bg: #1a1a1a; --card: #2d2d2d; --accent: #cfb53b; --text: #e0e0e0; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }
        .card { background: var(--card); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid var(--accent); }
        h2 { color: var(--accent); margin-top: 0; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        input, button { width: 100%; padding: 10px; margin: 5px 0; border-radius: 4px; border: none; box-sizing: border-box;}
        button { background: var(--accent); color: black; font-weight: bold; cursor: pointer; }
        .stats { font-size: 0.9em; opacity: 0.8; }
    </style>
</head>
<body>

    <h1>ArmorLog</h1>

    <div class="card">
        <h2>Ammo Inventory</h2>
        <div id="ammo-list"></div>
        <hr>
        <div class="grid">
            <input type="text" id="new-caliber" placeholder="Caliber (e.g. 9mm)">
            <input type="number" id="new-qty" placeholder="Qty">
        </div>
        <button onclick="addAmmo()">Add / Update Ammo</button>
    </div>

    <div class="card">
        <h2>Firearms & Maintenance</h2>
        <div id="gun-list"></div>
        <hr>
        <input type="text" id="gun-name" placeholder="Firearm Name (e.g. Glock 19)">
        <button onclick="addGun()">Add New Firearm</button>
    </div>

<script>
    // Initialize Data from LocalStorage
    let data = JSON.parse(localStorage.getItem('armorLog')) || { guns: [], ammo: {} };

    function save() {
        localStorage.setItem('armorLog', JSON.stringify(data));
        render();
    }

    function addAmmo() {
        const cal = document.getElementById('new-caliber').value;
        const qty = parseInt(document.getElementById('new-qty').value);
        if(!cal || isNaN(qty)) return;
        data.ammo[cal] = (data.ammo[cal] || 0) + qty;
        save();
    }

    function addGun() {
        const name = document.getElementById('gun-name').value;
        if(!name) return;
        data.guns.push({ name: name, rounds: 0, lastService: 0 });
        save();
    }

    function logSession(index) {
        const count = parseInt(prompt("How many rounds fired?"));
        const cal = prompt("Which caliber was used?");
        if(isNaN(count) || !data.ammo[cal]) return alert("Invalid count or caliber not in inventory");
        
        data.guns[index].rounds += count;
        data.ammo[cal] -= count;
        save();
    }

    function render() {
        // Render Ammo
        const ammoDiv = document.getElementById('ammo-list');
        ammoDiv.innerHTML = Object.entries(data.ammo).map(([cal, qty]) => 
            `<div class="grid"><span>${cal}:</span> <strong>${qty} rds</strong></div>`
        ).join('');

        // Render Guns
        const gunDiv = document.getElementById('gun-list');
        gunDiv.innerHTML = data.guns.map((gun, i) => `
            <div style="margin-bottom:15px; border-bottom:1px solid #444; padding-bottom:10px;">
                <strong>${gun.name}</strong><br>
                <span class="stats">Lifetime Rounds: ${gun.rounds} | Since Last Clean: ${gun.rounds - gun.lastService}</span>
                <div class="grid">
                    <button onclick="logSession(${i})">Log Session</button>
                    <button style="background:#555; color:white;" onclick="data.guns[${i}].lastService=${gun.rounds}; save();">Mark Cleaned</button>
                </div>
            </div>
        `).join('');
    }

    render();
</script>
</body>
</html>